<!--pages/index-page/index-page.component.html -->

<!-- HTML -->
<div class="inventory-search">
  <section class="search-card">
    <header class="card-header">
      <div class="title-block">
        <p class="eyebrow">Inventory lookup</p>
        <h2>Find parts by number, description, or supplier SKU</h2>
        <p class="hint">Use branches and availability to zero in on what is in stock.</p>
      </div>
      <div class="summary-chip">
        <span class="dot"></span>
        Live data
      </div>
    </header>

    <form class="form-grid" [formGroup]="form" (ngSubmit)="onSearch()">
      <div class="field criteria-field">
        <label for="criteria">Criteria</label>
        <input
          id="criteria"
          formControlName="criteria"
          (keyup.enter)="onEnterKey()"
          placeholder="Enter part number, description, or SKU" />
        <small>Press Enter to search quickly</small>
      </div>

      <div class="field select-field">
        <label for="by">Search by</label>
        <div class="select-wrap">
          <select id="by" formControlName="by">
            <option *ngFor="let opt of byOptions" [value]="opt.value">{{ opt.label }}</option>
          </select>
          <span class="select-caret">v</span>
        </div>
      </div>

      <div class="field branch-group branches-field" #branchContainer>
        <div class="field-label-row">
          <label>Branches</label>
          <small *ngIf="!(form.value.branches?.length)">Showing all when none selected</small>
          <small *ngIf="form.value.branches?.length">{{ form.value.branches.length }} selected</small>
        </div>
        <button type="button" class="branch-trigger" (click)="toggleBranchList()" [attr.aria-expanded]="branchListOpen">
          <span *ngIf="!(form.value.branches?.length)">Select branches (optional)</span>
          <span class="chip-list" *ngIf="form.value.branches?.length">
            <span class="chip" *ngFor="let b of form.value.branches">{{ b }}</span>
          </span>
          <span class="chevron">{{ branchListOpen ? '^' : 'v' }}</span>
        </button>
        <div class="branch-dropdown" *ngIf="branchListOpen">
          <button
            type="button"
            *ngFor="let branch of branches"
            class="branch-option"
            (click)="onBranchSelect(branch)">
              <span class="checkmark" [class.checked]="(form.value.branches || []).includes(branch)">‚úî</span>
              <span>{{ branch }}</span>
          </button>
        </div>
      </div>

      <div class="field checkbox">
        <label>
          <input type="checkbox" formControlName="onlyAvailable" />
          <span>Only show available</span>
        </label>
        <small>Filters to items with stock on hand</small>
      </div>

      <div class="actions">
        <button class="secondary" type="button" (click)="form.reset({ criteria: '', by: 'PartNumber', branches: [], onlyAvailable: false })">
          <span class="btn-icon">‚Ü∫</span> Reset
        </button>
        <button class="primary" type="submit" [disabled]="form.invalid || (loading$ | async)">
          <span class="btn-icon">üîçÔ∏é</span>
          <span *ngIf="!(loading$ | async)">Search</span>
          <span *ngIf="loading$ | async">Searching...</span>
        </button>
      </div>
    </form>
  </section>

  <div class="loading" *ngIf="loading$ | async">Loading results‚Ä¶</div>
  <div class="error" *ngIf="errorMessage">{{ errorMessage }}</div>

  <inventory-results-table
    [items]="items$ | async"
    [total]="(total$ | async) ?? 0"
    [pageSize]="pageSize"
    (sort)="onSort($event)"
    (pageChange)="onPageChange($event)">
  </inventory-results-table>
</div>
